# 🧪 Debuggle UI Test Suite

Comprehensive UI testing suite for the Debuggle web interface using Playwright and pytest.

## 🎯 Overview

This UI test suite provides comprehensive coverage of the Debuggle web interface, including:

- **Basic UI functionality** (page loading, navigation, forms)
- **Interactive tag functionality** (the bug we just fixed!)
- **File upload and processing workflows**
- **WebSocket real-time monitoring**
- **API integration testing**
- **Cross-browser compatibility**

## 🚀 Quick Start

### 1. Setup UI Testing Environment

```bash
# Install dependencies and set up browsers
make setup-ui-tests

# Or manually:
./setup_ui_tests.sh
```

### 2. Start Debuggle Server

```bash
# The UI tests need a running server
python entry_point.py serve
```

### 3. Run UI Tests

```bash
# Run all UI tests
make test-ui

# Run specific test categories
make test-ui-basic      # Basic UI functionality
make test-ui-tags       # Tag interaction tests
make test-ui-upload     # File upload tests
make test-ui-websocket  # WebSocket/real-time tests
make test-ui-integration # API integration tests

# Run with visible browser (for debugging)
make test-ui-debug

# Generate comprehensive report
make test-report
```

## 📋 Test Categories

### 🔧 Basic UI Tests (`test_ui_basic.py`)
- Page loading and title verification
- Header and navigation elements
- Option toggles (Summarize, Tags, Highlight)
- Responsive design (mobile, tablet, desktop)
- Keyboard navigation and accessibility

### 🏷️ Tag Interaction Tests (`test_ui_tags.py`)
**This is where we test the interactive tag bug fix!**
- Tag clicking and highlighting
- Multiple tag selection
- Tag-to-content mapping verification
- JavaScript error detection
- Scroll behavior on tag clicks

### 📁 File Upload Tests (`test_ui_file_upload.py`)
- Single file upload via input
- Multiple file upload and queue management
- Drag & drop functionality
- File processing workflows
- Error handling for invalid files

### 🔌 WebSocket Tests (`test_ui_websocket.py`)
- WebSocket connection establishment
- Real-time error monitoring
- Live notifications
- Connection status indicators
- Error stats API integration

### 🔗 API Integration Tests (`test_ui_api_integration.py`)
- End-to-end API call verification
- UI-to-API data consistency
- Error handling and display
- Metadata accuracy
- Complete workflow testing

## 🛠️ Test Infrastructure

### Test Runner (`run_ui_tests.py`)
Smart test runner that:
- Automatically starts/stops Debuggle server
- Manages browser setup
- Provides detailed reporting
- Handles cleanup on interruption

```bash
# Examples
./run_ui_tests.py --category tags --headed
./run_ui_tests.py --report --no-server  # If server already running
./run_ui_tests.py --setup  # Just set up environment
```

### Configuration
- **Playwright Config**: `playwright.config.toml`
- **Pytest Config**: `pytest.ini` (generated by setup script)
- **Browser Settings**: Chromium and Firefox support

## 🐛 Debugging UI Tests

### Running Tests with Visible Browser
```bash
make test-ui-debug
# Or
./run_ui_tests.py --headed --debug
```

### Common Debug Scenarios
1. **Tag interaction not working**: Check console for JavaScript errors
2. **File upload failing**: Verify file permissions and server response
3. **WebSocket connection issues**: Check server logs and network tab
4. **Slow tests**: Use `--slow-mo` option to slow down actions

### Browser DevTools
When running with `--headed`, you can:
- Open DevTools to inspect elements
- Check console for JavaScript errors
- Monitor network requests
- Debug CSS styling issues

## 📊 Test Reports

### HTML Reports
```bash
make test-report
# Generates: test-results/ui-test-report.html
```

### Coverage Integration
UI tests can be combined with unit test coverage:
```bash
make test-all  # Runs both unit and UI tests
```

## 🎯 Why This Matters

**Remember the tag interaction bug?** Our API tests passed but the UI was broken because:

1. **API Layer**: ✅ Working (backend processes tags correctly)
2. **Display Layer**: ✅ Working (tags render in HTML)
3. **Interaction Layer**: ❌ Broken (JavaScript click handlers failing)

**UI tests catch these interaction layer bugs** that pure API testing misses.

## 🔧 Extending the Test Suite

### Adding New Test Categories

1. Create new test file: `tests/test_ui_new_feature.py`
2. Follow existing patterns:
   ```python
   import pytest
   from playwright.sync_api import Page, expect

   class TestNewFeature:
       def test_feature_works(self, page: Page, live_server_url: str):
           page.goto(live_server_url)
           # Test implementation
   ```

3. Add to test runner categories in `run_ui_tests.py`
4. Add Makefile target if needed

### Test Fixtures
Common fixtures available:
- `live_server_url`: Running Debuggle server URL
- `sample_log_file`: Basic test log file
- `multiple_test_files`: List of test files
- `error_log_file`: Log with various error types

## 🚦 CI/CD Integration

### GitHub Actions Example
```yaml
- name: Run UI Tests
  run: |
    make setup-ui-tests
    make test-ui
```

### Docker Testing
```bash
# Run tests in containerized environment
docker run --rm -v $(pwd):/app debuggle-test make test-ui
```

## 🏆 Best Practices

1. **Start Simple**: Begin with basic page load tests
2. **Test User Journeys**: Focus on complete workflows
3. **Handle Async Operations**: Use `expect().to_be_visible(timeout=X)`
4. **Clean Test Data**: Use temporary files and cleanup
5. **Isolate Tests**: Each test should be independent
6. **Debug Locally**: Use `--headed` for visual debugging

## 📈 Measuring Success

Good UI test coverage should catch:
- ✅ JavaScript errors and broken interactions
- ✅ API integration issues
- ✅ Responsive design problems
- ✅ File upload edge cases
- ✅ Real-time functionality issues
- ✅ Cross-browser compatibility problems

The tag interaction bug would have been caught immediately with this test suite! 🎯